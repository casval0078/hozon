<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Upload Board</title>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, orderBy, query, serverTimestamp, deleteDoc, doc , getDoc } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBf1jDkivK4IjWhK613ysNhlhfJrVa5Z4s",
            authDomain: "hozon-4794d.firebaseapp.com",
            projectId: "hozon-4794d",
            storageBucket: "hozon-4794d.appspot.com",
            messagingSenderId: "363639067783",
            appId: "1:363639067783:web:89c021b8c297cf60e2d422",
            measurementId: "G-NKKQJM5VQY"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const nameInput = document.getElementById('nameInput');
            const textInput = document.getElementById('textInput');
            const deleteKeyInput = document.getElementById('deleteKeyInput');
            const file = fileInput.files[0];
            const name = nameInput.value;
            const description = textInput.value;
            const deleteKey = deleteKeyInput.value;
            const storageRef = ref(storage, 'uploads/' + file.name);

            try {
                const snapshot = await uploadBytes(storageRef, file);
                const downloadURL = await getDownloadURL(snapshot.ref);

                await addDoc(collection(db, "posts"), {
                    name: name,
                    description: description,
                    imageUrl: downloadURL,
                    deleteKey: deleteKey,
                    timestamp: serverTimestamp()
                });

                displayPosts();
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function displayPosts() {
    const postsContainer = document.getElementById('postsContainer');
    postsContainer.innerHTML = '';
    const postsQuery = query(collection(db, "posts"), orderBy("timestamp", "desc"));
    const querySnapshot = await getDocs(postsQuery);

    querySnapshot.forEach(doc => {
        const post = doc.data();
        const postElement = document.createElement('div');
        postElement.innerHTML = `
            <img src="${post.imageUrl}" alt="Uploaded Image" style="width: 100px; height: auto;">
            <p>${post.name}: ${post.description}</p>
            <input type="text" placeholder="Delete key" id="deleteKey-${doc.id}">
            <button id="deleteButton-${doc.id}">Delete</button>
        `;
        postElement.querySelector('img').onclick = () => window.open(post.imageUrl, '_blank');
        const deleteButton = postElement.querySelector(`#deleteButton-${doc.id}`);
        deleteButton.addEventListener('click', () => deletePost(doc.id));
        postsContainer.appendChild(postElement);
    });
}


        async function deletePost(postId) {
        const deleteKeyInput = document.getElementById('deleteKey-' + postId);
        const postRef = doc(db, "posts", postId);
        const postDoc = await getDoc(postRef);
        if (postDoc.exists() && postDoc.data().deleteKey === deleteKeyInput.value) {
            await deleteDoc(postRef);
            displayPosts();
        } else {
            alert("Incorrect delete key!");
        }
    }

    window.onload = () => {
        document.getElementById('uploadButton').addEventListener('click', uploadFile);
        displayPosts();
    };
</script>
</head>
<body>
    <input type="file" id="fileInput">
    <input type="text" id="nameInput" placeholder="Your Name">
    <input type="text" id="textInput" placeholder="Enter description">
    <input type="text" id="deleteKeyInput" placeholder="Enter a delete key">
    <button id="uploadButton">Upload</button>
    <div id="postsContainer"></div>
</body>
</html>
</html>
