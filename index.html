<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Media List</title>
</head>
<body>
    <h1>Available Media</h1>
    <ul id="mediaList"></ul>

    <!-- Firebase SDKの追加 (モジュールとして) -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
        import { getStorage, ref, listAll, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js';

        // Firebase設定の初期化
        const firebaseConfig = {
            apiKey: "AIzaSyBf1jDkivK4IjWhK613ysNhlhfJrVa5Z4s",
            authDomain: "hozon-4794d.firebaseapp.com",
            projectId: "hozon-4794d",
            storageBucket: "hozon-4794d.appspot.com",
            messagingSenderId: "363639067783",
            appId: "1:363639067783:web:89c021b8c297cf60e2d422",
            measurementId: "G-NKKQJM5VQY"

        };
        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);

        // メディアリストを取得して表示
        async function loadMediaList() {
            const mediaList = document.getElementById('mediaList');
            const storageRef = ref(storage); 

            try {
                const result = await listAll(storageRef);
                const sortedItems = result.items.sort((a, b) => a.name.localeCompare(b.name)); // 名前でソート
                sortedItems.forEach(async (itemRef) => {
                    const url = await getDownloadURL(itemRef);
                    const li = document.createElement('li');
                    const link = document.createElement('a');
                    link.href = `play.html?mediaUrl=${encodeURIComponent(url)}`; // play.html はメディアを再生するページ
                    link.textContent = itemRef.name;
                    link.target = '_blank';
                    li.appendChild(link);
                    mediaList.appendChild(li);
                });
            } catch (error) {
                console.log('Error loading media list:', error);
            }
        }

        window.onload = loadMediaList;
    </script>
</body>
</html>
